<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">

    <link rel="alternate" type="application/rss+xml" title="Jeremy Tuloup's Blog" href="http://www.jtp.io/feed.xml">

    <title>Jeremy Tuloup's Blog - MalmöMilen pre-analysis</title>

    <link rel="shortcut icon" type="image/png" href="favicon.png"/>

    <!-- Bootstrap core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.5/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
    <style>
      .MathJax_Preview { color: #888 }
      .math_finished .MathJax_Preview { display: none }
    </style>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <div id="top" class="container">

<div class="row top">
  <div class="col-md-12 col-xs-18 col-sm-12">
    <a href="/" class="btn btn-default" title="Home">JTP</a>
    
      
        
      
        
      
        
      
        
          
            <a href="/index.html" class="btn btn-primary">Blog</a>
          
        
      
    
      
        
      
        
      
        
          
            <a href="/gameJams.html" class="btn btn-primary">Game Jams</a>
          
        
      
        
      
    
      
        
          
            <a href="/about.html" class="btn btn-primary">About</a>
          
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
    <a href="https://github.com/jtpio" class="btn btn-primary" title="Github"><i class="fa fa-github-square fa-1x"></i></a>
    <a href="https://twitter.com/jtpio" class="btn btn-primary" title="Twitter"><i class="fa fa-twitter-square fa-1x"></i></a>
    <a href="http://www.linkedin.com/in/jtuloup" class="btn btn-primary" title="LinkedIn"><i class="fa fa-linkedin-square fa-1x"></i></a>
  </div>
</div>


<div class="row">
  <div class="col-md-12 col-xs-18 col-sm-12">
	  <h2> <strong> MalmöMilen pre-analysis </strong> &ndash; June 27, 2014 </h2>
<h4>

	<span class="label label-default">data</span>

	<span class="label label-default">scraping</span>

	<span class="label label-default">python</span>

</h4>

<p>
  As a pretext to write a meaningful blog post, I wanted to go back to one of my recent little hacks.
</p>

<p>
  There was a race, <a href="http://www.malmomilen.se/">MalmöMilen</a>, which happened on June 14, 2014. But before actually going to the race, I wanted to know what was the distribution of the participants into the different start groups. <br />
  I had registered myself in the 50-55 minutes start group, but I knew I would do less than 44 minutes (yes that was a stupid choice). The question then was to know how many runners (roughly) will be positioned before and that I will have to overtake.
</p>

<p>
  The simple solution was to use an <a href="http://nbviewer.ipython.org/gist/jtuloup/bb218bf22605d56ab670">iPython notebook</a> and do some data scraping, directly using the data from their website. Code (pretty short and simple) and graph follow.
</p>

<p>


<div class="highlight"><pre><code class="language-python3" data-lang="python3"><span class="kn">from</span> <span class="nn">bs4</span> <span class="k">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://www.malmomilen.se/anmaelan/startlista-2014&#39;</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span>

<span class="n">ps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="k">else</span> <span class="s">&#39;N/A&#39;</span>
    <span class="k">if</span> <span class="n">time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">ps</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ps</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot; participants&quot;</span><span class="p">)</span></code></pre></div>


</p>

<p>
This is how we get the number of participant and group them by start time. <br />
The following illustrates how to visualize the distribution on a nice graph.
</p>

<div class="highlight"><pre><code class="language-python3" data-lang="python3"><span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="p">;</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">sorted_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Elitgruppen&#39;</span><span class="p">,</span> <span class="s">&#39;Under 42 minuter&#39;</span><span class="p">,</span> <span class="s">&#39;Under 45 minuter&#39;</span><span class="p">,</span> <span class="s">&#39;45-50 minuter&#39;</span><span class="p">,</span>
                 <span class="s">&#39;50-55 minuter&#39;</span><span class="p">,</span> <span class="s">&#39;55-60 minuter&#39;</span><span class="p">,</span> <span class="s">&#39;60+ minuter&#39;</span><span class="p">,</span> <span class="s">&#39;Barnloppet&#39;</span><span class="p">]</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">sorted_groups</span><span class="p">]</span>
<span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">ps</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

<span class="n">rects</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Number of participants&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Start group distribution&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rects</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<p>
Which plots the following graph:
</p>

<div class="embed-responsive embed-responsive-16by9">
  <img class="embed-responsive-item" src="http://www.jtp.io/res/ipython/malmomilen-pre-start-group.png" />
</div>

<p>
Now that the race is finished and results are out, I really want to play with the available data and make it say something. <br />
Next time!
</p>


<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'jtzp4'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</div>

<hr>

  <div class="row col-md-12 col-xs-18 col-sm-12">
    <p><small>By <a href="#top">Jeremy Tuloup</a> &ndash; 2015 &ndash; Theme by <a href="http://bootswatch.com/">bootswatch</a> </small></p>
  </div>

  </div> <!-- /container -->

  <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>

  <script>
    var scripts = document.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
      /* TODO: keep going after an individual parse error. */
      var script = scripts[i];
      if (script.type.match(/^math\/tex/)) {
        var text = script.text === "" ? script.innerHTML : script.text;
        var options = script.type.match(/mode\s*=\s*display/) ?
                      {displayMode: true} : {};
        script.insertAdjacentHTML("beforebegin",
                                  katex.renderToString(text, options));
      }
    }
    document.body.className += " math_finished";
  </script>

  <script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>

  <script type="text/javascript">
    try {
      var pageTracker = _gat._getTracker("UA-51952511-1");
      pageTracker._trackPageview();
    } catch(err) {}
  </script>

  </body>
</html>
