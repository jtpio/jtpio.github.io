<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">

    <link rel="alternate" type="application/rss+xml" title="Jeremy Tuloup" href="https://www.jtp.io/feed.xml">

    <title>Jeremy Tuloup - Analyzing Malmö Language Exchange Meetup</title>

    <link rel="canonical" href="https://www.jtp.io/2014/10/22/meetup-malmo-language.html" />
    <link rel="shortcut icon" type="image/png" href="/favicon.png"/>

    <!-- Bootstrap core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.5/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
    <style>
      .MathJax_Preview { color: #888 }
      .math_finished .MathJax_Preview { display: none }
    </style>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <div id="top" class="container">

<div class="row top">
  <div class="col-md-12 col-xs-18 col-sm-12">
    <a href="/" class="btn btn-default" title="Home">JTP</a>
    
      
        
      
        
      
        
      
        
          
            <a href="/" class="btn btn-primary">Blog</a>
          
        
      
    
      
        
      
        
      
        
          
            <a href="/gameJams" class="btn btn-primary">Game Jams</a>
          
        
      
        
      
    
      
        
          
            <a href="/about" class="btn btn-primary">About</a>
          
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
    
    <a href="//github.com/jtpio" class="btn btn-primary" title="Github"><i class="fa fa-github-square fa-1x"></i></a>
    <a href="//twitter.com/jtpio" class="btn btn-primary" title="Twitter"><i class="fa fa-twitter-square fa-1x"></i></a>
    <a href="//www.linkedin.com/in/jtuloup" class="btn btn-primary" title="LinkedIn"><i class="fa fa-linkedin-square fa-1x"></i></a>
  </div>
</div>


<div class="row">
  <div class="col-md-12 col-xs-18 col-sm-12">
	  <h2> <strong> Analyzing Malmö Language Exchange Meetup </strong> &ndash; October 22, 2014 </h2>
<h4>

	<span class="label label-default">data</span>

	<span class="label label-default">node</span>

	<span class="label label-default">NLP</span>

</h4>

<p>
  <a href="//meetup.com">Meetup</a> is a wonderful platform. It makes it super easy to find groups of people sharing common interests, and it also provides an API! <br />
</p>

<p>
  I have been several times to the <a href="//www.meetup.com/intercambio3">Language Exchange group</a> events in Malmö. This is a group bringing people together so they can practice languages. There are events for a lot of languages: swedish, portuguese, spanish and more. And it's always a good opportunity to meet new people from all around the world. <br />
</p>

<p>
  To join this group, some questions must be answered, and one of them is: <strong>What is your mother tongue?</strong><br />
  To that question, the members usually answer in English with just a few words, like "Swedish" or "I am a native French". Since I want to know what language the members speak nativally and create the language distribution, I focused the analysis on that question.<br />
</p>

<h3>Links</h3>

<p class="bigger">
  Visualization: <a href="//malmolanguage.jtp.io">malmolanguage.jtp.io</a>
</p>

<p>
  The rest of the post focuses <strong> only on some specific parts </strong> of the code, that you can find on github:<br />
  <a href="//github.com/jtpio/meetup-malmo-language">github.com/jtpio/meetup-malmo-language</a>
</p>

<h3>Using the Meetup API</h3>

<p>
  Instead of browsing hundreds of profiles manually, there exists a better tool for that task: the Meetup API. The documentation can be found here: <a href="//www.meetup.com/meetup_api">meetup.com/meetup_api</a> <br />

  In the code, we define variables for that meetup group, as well as the meetup API key that is placed in an environment variable. Here we use "/2/profiles" as the URL path to retrieve the profile details, since they contain the answers to the question.
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">malmo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'question'</span><span class="p">:</span> <span class="mi">2187832</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'intercambio3'</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">MEETUP_KEY</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MEETUP_KEY</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">QUESTION_ID</span> <span class="o">=</span> <span class="nx">malmo</span><span class="p">.</span><span class="nx">question</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">urlObj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">protocol</span><span class="p">:</span> <span class="s1">'https'</span><span class="p">,</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'api.meetup.com'</span><span class="p">,</span>
    <span class="na">pathname</span><span class="p">:</span> <span class="s1">'/2/profiles'</span><span class="p">,</span>
    <span class="na">query</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">group_urlname</span><span class="p">:</span> <span class="nx">malmo</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">sign</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">key</span><span class="p">:</span> <span class="nx">MEETUP_KEY</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

</p>

<p>
  After getting the response, the answer for the question needs to be filtered and passed to the analyzer. Then if the response contains any cursor (the "next" property), use it to retrieve the next data (apparently Meetup limits the number of results to 200 per page, even though there is no limit set in the request).
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">results</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ans</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">answers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ans</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ans</span><span class="p">.</span><span class="nx">question_id</span> <span class="o">===</span> <span class="nx">QUESTION_ID</span><span class="p">;</span>
    <span class="p">})[</span><span class="mi">0</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">ans</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">analyzer</span><span class="p">.</span><span class="nx">extractLanguage</span><span class="p">(</span><span class="nx">ans</span><span class="p">.</span><span class="nx">answer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">'next'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">next</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">crawl</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">next</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">analyzer</span><span class="p">.</span><span class="nx">printResults</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</p>

<h3> Analyzing the data with the node module Natural</h3>

<p>
  Once the answer is retrieved, the next part is to extract one or several languages from it. <br />
  The problem is that some people answer that question using a plain sentence, or mispelling words ... Doing a dictionary lookup against a list of languages is not enough in that situation. <br />
  Fortunately, Natural (<a href="//github.com/NaturalNode/natural">github.com/NaturalNode/natural</a>) comes as a handy tool, as it makes it possible to tokenize the answer using natural language techniques. The two useful features used for this application are the <strong>tokenization</strong> and the <strong>JaroWinklerDistance distance</strong>. <br />
  The first step is to sanitize the data to get a proper array of tokens.
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'lodash'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">tokenize</span><span class="p">(</span><span class="nx">str</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_normalize</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
<span class="p">}));</span></code></pre></figure>

</p>

<p>
  Then, for each token, increment the counter for that token if the language is found in the dictionary. It means that in this case the token is a language.
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">tokens</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">dictEN</span><span class="p">[</span><span class="nx">t</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">res</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">m</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</p>

<p>
  If the number of matches is 0, it means that we couldn't find any language in that sequence of tokens. Maybe the language has been mispelled? This is where the <strong>JaroWinklerDistance distance</strong> becomes useful. It is used to evaluate how different two strings are. We use it to compare each token to the available language, if there is one token close to a language, we can assume that the member wanted to type that language. The <em>DISTANCE_THRESHOLD</em> constant was arbitrarily chosen after some testing.
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// no match</span>
    <span class="nx">tokens</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">lang</span> <span class="k">in</span> <span class="nx">dictEN</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">dist</span> <span class="o">=</span> <span class="nx">natural</span><span class="p">.</span><span class="nx">JaroWinklerDistance</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">dist</span> <span class="o">&gt;</span> <span class="nx">DISTANCE_THRESHOLD</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">res</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">res</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
                <span class="nx">m</span><span class="o">++</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span> <span class="c1">// stop for this language</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

</p>

<p>
Finally, we keep track of the sentences giving no answer, as well as the number of people who mentionned more than one language as the mother tongue, just as simple stats.
</p>

<p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">unknown</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bilinguals</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</p>

<h3>Displaying the data</h3>

<p>
The visualization is done using <strong>d3</strong>. Please have a look at the source code for more details.
</p>

<div class="embed-responsive embed-responsive-16by9">
  <img class="embed-responsive-item" src="https://www.jtp.io/res/malmolanguage.png" />
</div>

<p>
What we can notice is that the number of <em>unknown</em> is still acceptable, 64 / 721 = ~9%, but some of them are correct languages, except that they are written in Swedish ...
</p>

<h3>Conclusion</h3>

<p>
In this post, I presented a way for retrieving and analyzing answers from Meetup profiles. This is of course very dependent on the Meetup group structure and the questions asked to the members. This method can be used for other groups, but will need manual modifications for the question id and group url name.
</p>


<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'jtzp4'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</div>

<hr>

  <div class="row col-md-12 col-xs-18 col-sm-12">
    <p><small>By <a href="#top">Jeremy Tuloup</a> &ndash; 2016 &ndash; Theme by <a href="http://bootswatch.com/">bootswatch</a> </small></p>
  </div>

  </div> <!-- /container -->

  <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>

  <script>
    var scripts = document.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
      /* TODO: keep going after an individual parse error. */
      var script = scripts[i];
      if (script.type.match(/^math\/tex/)) {
        var text = script.text === "" ? script.innerHTML : script.text;
        var options = script.type.match(/mode\s*=\s*display/) ?
                      {displayMode: true} : {};
        script.insertAdjacentHTML("beforebegin",
                                  katex.renderToString(text, options));
      }
    }
    document.body.className += " math_finished";
  </script>

  <script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>

  <script type="text/javascript">
    try {
      var pageTracker = _gat._getTracker("UA-51952511-1");
      pageTracker._trackPageview();
    } catch(err) {}
  </script>

  </body>
</html>
