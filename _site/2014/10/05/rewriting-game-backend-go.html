<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">

    <link rel="alternate" type="application/rss+xml" title="Jeremy Tuloup [JTP]- Blog" href="http://www.jtp.io/feed.xml">

    <title>Jeremy Tuloup - Rewriting our game backend in Go</title>

    <link rel="shortcut icon" type="image/png" href="favicon.png"/>

    <!-- Bootstrap core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>

    <div id="top" class="container">

      <div class="navbar navbar-default">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">JTP</a>
        </div>
        <div class="navbar-collapse navbar-responsive-collapse collapse" style="height: 1px;">
          <ul class="nav navbar-nav">
            
              
                
              
                
              
                
              
                
                  
                    <li><a href="/index.html">Hi</a></li>
                  
                
              
                
              
            
              
                
              
                
              
                
                  
                    <li><a href="/gameJams.html">Game Jams</a></li>
                  
                
              
                
              
                
                  
                    <li><a href="/misc.html">Projects</a></li>
                  
                
              
            
              
                
                  
                    <li><a href="/blog.html">Blog</a></li>
                  
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
              
                
              
                
              
                
              
                
              
                
              
            
          </ul>
        </div>
      </div>


      <div class="row">

        <div class="col-md-12 col-xs-18 col-sm-12">
      	  <h2> <strong> Rewriting our game backend in Go </strong> &ndash; October 05, 2014 </h2>
<h4>

	<span class="label label-default">game jam</span>

	<span class="label label-default">golang</span>

</h4>

<p>
  A few month ago at a game jam, we (me and my team) made a multiplayer web-based game with the help of the library <a href="https://github.com/greggman/HappyFunTimes"> HappyFunTimes </a>. <br />
  Using HappyFunTimes was great, because we had the network part up and running very quickly, so we were able to put more time on the gameplay. But HappyFunTimes has one drawback: there can only be one session of the game on the same local network (which is totally fine in the context of a game jam). <br />
</p>

<p>
  This was one of the main reason to rewrite backend, so multiple sessions of the game can be playable online at the same time. The other reason is that I wanted to do something in Go.
</p>

<p>
You can find the code right there: <a href="https://github.com/jtpio/twin-fusion">https://github.com/jtpio/twin-fusion</a>.<br />
Here is a very short summary of three  of the journey.
</p>

<h3>1. Code is small and simple</h3>
<p>
The entire server code fits in less than 350 lines of code. Go is simple and clean by nature.
</p>

<h3>2. Using JSON</h3>
<p>
One of the parts I got tricked by is the naming convention for variables and functions. I knew that in a module, a function name has to start with a capital letter in order for the function to be exported and be available from an other module. But this is also applied to the fields in structures: a field starting with a capital letter is public whereas starting with a lowercase letter will make it private.


<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">command</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Cmd</span>      <span class="kt">string</span>                 <span class="c1">// public</span>
  <span class="nx">PlayerID</span> <span class="kt">uint32</span>                 <span class="c1">// public</span>
  <span class="nx">data</span>     <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span> <span class="c1">// private</span>
<span class="p">}</span></code></pre></div>


</p>
<p>Following that rule, private fields will not be passed along when encoded to JSON. <br /></p>

<p>Speaking of JSON, Go makes it possible to customize field names in a very neat way, using tags. It can be used to switch the first letter back to lowercase for example.</p>

<p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">command</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Cmd</span>      <span class="kt">string</span>                 <span class="s">`json:&quot;cmd&quot;`</span>
  <span class="nx">PlayerID</span> <span class="kt">uint32</span>                 <span class="s">`json:&quot;playerID&quot;`</span>
  <span class="nx">Data</span>     <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&quot;data&quot;`</span>
<span class="p">}</span></code></pre></div>


</p>

<h3>3. Think with channels</h3>
<p>Node has callbacks, Go has channels. <br />
Need to run something asynchronously? Create a channel, pass that channel to the task and wait on that channel for the value to be returned. <br />
In the context of that game, channels are used to send commands from the players to the game instance and vice versa.</p>

<h3>State of the game</h3>
<p>
Twin fusion is now quite stable. The idea is to polish it a bit more, especially on the controller UI. After that, it has all the elements to be available online and become a good and quick party game that anyone can reach quickly to play with friends!
</p>

<p>
This was mostly a reason for me to seize Go differences, as I come with a node.js background. In the end it was a good exercise.
</p>


<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'jtzp4'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>

      </div>

      <div class="row col-md-12 col-xs-18 col-sm-12">
        <p><small>By <a href="#top">Jeremy Tuloup</a> &ndash; 2014 &ndash; Theme by <a href="http://bootswatch.com/">bootswatch</a> </small></p>
      </div>

    </div> <!-- /container -->

  	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>

    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-51952511-1");
      pageTracker._trackPageview();
      } catch(err) {}
    </script>

  </body>
</html>



